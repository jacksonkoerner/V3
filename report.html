<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Field Report - Official Document</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dot-navy': '#0a1628',
                        'dot-blue': '#1e3a5f',
                        'dot-slate': '#334155',
                        'dot-orange': '#ea580c',
                        'dot-yellow': '#f59e0b',
                        'safety-green': '#16a34a',
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
        @media print {
            body { background: white !important; }
            .no-print { display: none !important; }
            .print-page { page-break-after: always; break-after: page; }
            .print-page:last-child { page-break-after: avoid; break-after: avoid; }
            .print-section { page-break-inside: avoid; }
        }
        .header-stripe {
            background: repeating-linear-gradient(-45deg, #f59e0b, #f59e0b 10px, #0a1628 10px, #0a1628 20px);
            height: 4px;
        }
        .official-stamp {
            border: 3px double #1e3a5f;
            position: relative;
        }
        .official-stamp::before {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            right: 4px;
            bottom: 4px;
            border: 1px solid #1e3a5f;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen">
    <!-- NO-PRINT TOOLBAR -->
    <div class="no-print sticky top-0 z-50 bg-dot-navy border-b border-slate-700">
        <div class="header-stripe"></div>
        <div class="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
            <a href="index.html" class="flex items-center gap-2 text-slate-400 hover:text-white transition-colors">
                <i class="fas fa-arrow-left"></i>
                <span class="text-sm font-medium uppercase">Back</span>
            </a>
            <div class="flex items-center gap-2">
                <button onclick="exportReport()" class="px-4 py-2 bg-dot-blue text-white text-xs font-bold uppercase hover:bg-blue-800 transition-colors">
                    <i class="fas fa-file-export mr-2"></i>Export
                </button>
                <button onclick="window.print()" class="px-4 py-2 bg-safety-green text-white text-xs font-bold uppercase hover:bg-green-700 transition-colors">
                    <i class="fas fa-print mr-2"></i>Print
                </button>
            </div>
        </div>
    </div>

    <!-- REPORT CONTENT -->
    <div class="max-w-4xl mx-auto p-4 pb-20">

        <!-- PAGE 1: OVERVIEW -->
        <div class="print-page bg-white shadow-lg mb-8">
            <!-- Header -->
            <div class="header-stripe"></div>
            <div class="bg-dot-navy text-white p-6">
                <div class="flex items-start justify-between">
                    <div>
                        <div class="flex items-center gap-3 mb-2">
                            <i class="fas fa-clipboard-check text-dot-yellow text-2xl"></i>
                            <div>
                                <p class="text-[10px] font-bold tracking-widest text-dot-yellow uppercase">Daily Inspection Report</p>
                                <h1 class="text-2xl font-bold tracking-tight">Resident Project Representative</h1>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-slate-400 uppercase">Document No.</p>
                        <p id="reportDocNo" class="text-lg font-bold text-dot-yellow">--</p>
                    </div>
                </div>
            </div>

            <!-- Project Info -->
            <div class="p-6 border-b-2 border-slate-200">
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <p class="text-xs font-bold text-dot-blue uppercase tracking-wider mb-1">Project Name</p>
                        <p id="projectName" class="text-lg font-bold text-slate-800">--</p>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-dot-blue uppercase tracking-wider mb-1">Report Date</p>
                        <p id="reportDate" class="text-lg font-bold text-slate-800">--</p>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-dot-blue uppercase tracking-wider mb-1">NOAB Project No.</p>
                        <p id="noabProjectNo" class="text-base font-medium text-slate-700">--</p>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-dot-blue uppercase tracking-wider mb-1">Contract Day</p>
                        <p id="contractDay" class="text-base font-medium text-slate-700">--</p>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-dot-blue uppercase tracking-wider mb-1">Contractor</p>
                        <p id="contractor" class="text-base font-medium text-slate-700">--</p>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-dot-blue uppercase tracking-wider mb-1">Location</p>
                        <p id="location" class="text-base font-medium text-slate-700">--</p>
                    </div>
                </div>
            </div>

            <!-- Weather -->
            <div class="p-6 border-b-2 border-slate-200">
                <h2 class="flex items-center gap-2 text-sm font-bold text-dot-blue uppercase tracking-wider mb-4">
                    <i class="fas fa-cloud-sun"></i>
                    Weather Conditions
                </h2>
                <div class="grid grid-cols-4 gap-4">
                    <div class="text-center p-4 bg-slate-50 border border-slate-200">
                        <p class="text-xs text-slate-500 uppercase mb-1">Condition</p>
                        <p id="weatherCondition" class="text-sm font-bold text-slate-800">--</p>
                    </div>
                    <div class="text-center p-4 bg-slate-50 border border-slate-200">
                        <p class="text-xs text-slate-500 uppercase mb-1">High Temp</p>
                        <p id="weatherHigh" class="text-sm font-bold text-slate-800">--</p>
                    </div>
                    <div class="text-center p-4 bg-slate-50 border border-slate-200">
                        <p class="text-xs text-slate-500 uppercase mb-1">Low Temp</p>
                        <p id="weatherLow" class="text-sm font-bold text-slate-800">--</p>
                    </div>
                    <div class="text-center p-4 bg-slate-50 border border-slate-200">
                        <p class="text-xs text-slate-500 uppercase mb-1">Precipitation</p>
                        <p id="weatherPrecip" class="text-sm font-bold text-slate-800">--</p>
                    </div>
                </div>
                <div class="mt-4 p-4 bg-slate-50 border border-slate-200">
                    <p class="text-xs text-slate-500 uppercase mb-1">Site Conditions</p>
                    <p id="siteConditions" class="text-sm text-slate-800">--</p>
                </div>
            </div>

            <!-- Work Hours -->
            <div class="p-6 border-b-2 border-slate-200">
                <h2 class="flex items-center gap-2 text-sm font-bold text-dot-blue uppercase tracking-wider mb-4">
                    <i class="fas fa-clock"></i>
                    Work Hours
                </h2>
                <div class="grid grid-cols-3 gap-4">
                    <div class="text-center p-4 bg-slate-50 border border-slate-200">
                        <p class="text-xs text-slate-500 uppercase mb-1">Start Time</p>
                        <p id="startTime" class="text-lg font-bold text-slate-800">--</p>
                    </div>
                    <div class="text-center p-4 bg-slate-50 border border-slate-200">
                        <p class="text-xs text-slate-500 uppercase mb-1">End Time</p>
                        <p id="endTime" class="text-lg font-bold text-slate-800">--</p>
                    </div>
                    <div class="text-center p-4 bg-safety-green/10 border-2 border-safety-green">
                        <p class="text-xs text-safety-green uppercase mb-1">Duration</p>
                        <p id="duration" class="text-lg font-bold text-safety-green">--</p>
                    </div>
                </div>
            </div>

            <!-- Contractors On Site -->
            <div class="p-6">
                <h2 class="flex items-center gap-2 text-sm font-bold text-dot-blue uppercase tracking-wider mb-4">
                    <i class="fas fa-users"></i>
                    Contractors On Site
                </h2>
                <div id="contractorsList" class="flex flex-wrap gap-2">
                    <span class="text-slate-400">No contractors listed</span>
                </div>
            </div>
        </div>

        <!-- PAGE 2: ACTIVITIES & PERSONNEL -->
        <div class="print-page bg-white shadow-lg mb-8">
            <div class="header-stripe"></div>
            <div class="bg-dot-navy text-white p-4">
                <h2 class="text-lg font-bold uppercase">Work Activities & Personnel</h2>
            </div>

            <!-- Activities -->
            <div class="p-6 border-b-2 border-slate-200">
                <h3 class="flex items-center gap-2 text-sm font-bold text-dot-blue uppercase tracking-wider mb-4">
                    <i class="fas fa-tasks"></i>
                    Work Performed
                </h3>
                <div id="activitiesList" class="space-y-3">
                    <p class="text-slate-400">No activities recorded</p>
                </div>
            </div>

            <!-- Personnel Counts -->
            <div class="p-6 border-b-2 border-slate-200">
                <h3 class="flex items-center gap-2 text-sm font-bold text-dot-blue uppercase tracking-wider mb-4">
                    <i class="fas fa-clipboard-list"></i>
                    Personnel Counts
                </h3>
                <div id="personnelTable" class="overflow-x-auto">
                    <p class="text-slate-400">No personnel data recorded</p>
                </div>
            </div>

            <!-- Equipment -->
            <div class="p-6">
                <h3 class="flex items-center gap-2 text-sm font-bold text-dot-blue uppercase tracking-wider mb-4">
                    <i class="fas fa-truck-pickup"></i>
                    Equipment On Site
                </h3>
                <div id="equipmentList" class="space-y-2">
                    <p class="text-slate-400">No equipment recorded</p>
                </div>
            </div>
        </div>

        <!-- PAGE 3: ISSUES, INSPECTIONS, SAFETY -->
        <div class="print-page bg-white shadow-lg mb-8">
            <div class="header-stripe"></div>
            <div class="bg-dot-navy text-white p-4">
                <h2 class="text-lg font-bold uppercase">Issues, Inspections & Safety</h2>
            </div>

            <!-- Issues -->
            <div class="p-6 border-b-2 border-slate-200">
                <h3 class="flex items-center gap-2 text-sm font-bold text-dot-orange uppercase tracking-wider mb-4">
                    <i class="fas fa-exclamation-triangle"></i>
                    Issues & Delays
                </h3>
                <div id="issuesList" class="space-y-3">
                    <p class="text-slate-400">No issues reported</p>
                </div>
            </div>

            <!-- QA/QC -->
            <div class="p-6 border-b-2 border-slate-200">
                <h3 class="flex items-center gap-2 text-sm font-bold text-violet-600 uppercase tracking-wider mb-4">
                    <i class="fas fa-check-double"></i>
                    QA/QC Inspections
                </h3>
                <div id="inspectionsList" class="space-y-3">
                    <p class="text-slate-400">No inspections recorded</p>
                </div>
            </div>

            <!-- Safety -->
            <div class="p-6 border-b-2 border-slate-200">
                <h3 class="flex items-center gap-2 text-sm font-bold text-safety-green uppercase tracking-wider mb-4">
                    <i class="fas fa-hard-hat"></i>
                    Safety
                </h3>
                <div id="safetyStatus" class="mb-4"></div>
                <div id="safetyNotes" class="space-y-3">
                    <p class="text-slate-400">No safety notes</p>
                </div>
            </div>

            <!-- Visitors -->
            <div class="p-6">
                <h3 class="flex items-center gap-2 text-sm font-bold text-dot-blue uppercase tracking-wider mb-4">
                    <i class="fas fa-user-tie"></i>
                    Visitors & Communications
                </h3>
                <div id="visitorsList" class="space-y-3">
                    <p class="text-slate-400">No visitors or communications recorded</p>
                </div>
            </div>
        </div>

        <!-- PAGE 4: PHOTOS -->
        <div id="photosPage" class="print-page bg-white shadow-lg mb-8 hidden">
            <div class="header-stripe"></div>
            <div class="bg-dot-navy text-white p-4">
                <h2 class="text-lg font-bold uppercase">Progress Photos</h2>
            </div>
            <div class="p-6">
                <div id="photosGrid" class="grid grid-cols-2 gap-4">
                    <p class="text-slate-400">No photos</p>
                </div>
            </div>
        </div>

        <!-- SIGNATURE -->
        <div class="print-section bg-white shadow-lg mb-8">
            <div class="header-stripe"></div>
            <div class="p-6">
                <div class="flex justify-between items-end gap-8">
                    <div class="flex-1">
                        <p class="text-xs font-bold text-dot-blue uppercase tracking-wider mb-2">Prepared By</p>
                        <div class="border-b-2 border-slate-400 pb-1">
                            <p id="preparedBy" class="text-lg font-bold text-slate-800">--</p>
                        </div>
                        <p class="text-xs text-slate-500 mt-1">Resident Project Representative</p>
                    </div>
                    <div class="flex-1">
                        <p class="text-xs font-bold text-dot-blue uppercase tracking-wider mb-2">Date</p>
                        <div class="border-b-2 border-slate-400 pb-1">
                            <p id="signatureDate" class="text-lg font-bold text-slate-800">--</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-dot-navy text-center py-3">
                <p class="text-[10px] text-slate-500 uppercase tracking-widest">
                    <i class="fas fa-shield-alt mr-1"></i>
                    DOT Compliant Field Documentation System
                </p>
            </div>
        </div>
    </div>

    <script>
        function getTodayKey() {
            return `fieldvoice_report_${new Date().toISOString().split('T')[0]}`;
        }

        function getReport() {
            const urlParams = new URLSearchParams(window.location.search);
            const specificKey = urlParams.get('key');
            if (specificKey) {
                const saved = localStorage.getItem(specificKey);
                if (saved) { try { return JSON.parse(saved); } catch (e) {} }
            }
            const saved = localStorage.getItem(getTodayKey());
            if (saved) { try { return JSON.parse(saved); } catch (e) {} }
            const legacy = localStorage.getItem('fieldvoice_report');
            if (legacy) { try { return JSON.parse(legacy); } catch (e) {} }
            return null;
        }

        function renderReport() {
            const report = getReport();
            if (!report) {
                document.body.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center bg-slate-100">
                        <div class="text-center p-8">
                            <i class="fas fa-file-excel text-6xl text-slate-300 mb-4"></i>
                            <h1 class="text-xl font-bold text-slate-700">No Report Found</h1>
                            <p class="text-slate-500 mt-2">Start a new report from the dashboard.</p>
                            <a href="index.html" class="inline-block mt-4 px-6 py-3 bg-dot-navy text-white font-bold uppercase hover:bg-dot-blue transition-colors">
                                <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                            </a>
                        </div>
                    </div>
                `;
                return;
            }

            const o = report.overview || {};
            const w = o.weather || {};

            const dateStr = o.date ? new Date(o.date).toISOString().split('T')[0].replace(/-/g, '') : 'XXXXXX';
            document.getElementById('reportDocNo').textContent = `RPR-${dateStr}`;

            document.getElementById('projectName').textContent = o.projectName || 'N/A';
            document.getElementById('reportDate').textContent = o.date || 'N/A';
            document.getElementById('noabProjectNo').textContent = o.noabProjectNo || '1291';
            document.getElementById('contractDay').textContent = o.contractDayNo || 'N/A';
            document.getElementById('contractor').textContent = o.contractor || 'Hunt, Gibbs, Boh, & Metro (HGBM)';
            document.getElementById('location').textContent = o.location || 'Louis Armstrong New Orleans Int\'l Airport';

            document.getElementById('weatherCondition').textContent = w.generalCondition || 'N/A';
            document.getElementById('weatherHigh').textContent = w.highTemp || 'N/A';
            document.getElementById('weatherLow').textContent = w.lowTemp || 'N/A';
            document.getElementById('weatherPrecip').textContent = w.precipitation || '0.00"';
            document.getElementById('siteConditions').textContent = w.jobSiteCondition || 'N/A';

            document.getElementById('startTime').textContent = o.startTime || 'N/A';
            document.getElementById('endTime').textContent = o.endTime || 'N/A';
            document.getElementById('duration').textContent = o.shiftDuration || 'N/A';

            const contractors = report.contractors || [];
            if (contractors.length > 0) {
                document.getElementById('contractorsList').innerHTML = contractors.map(c =>
                    `<span class="px-4 py-2 bg-dot-orange text-white font-bold text-sm">${c}</span>`
                ).join('');
            }

            const activities = report.activities || [];
            if (activities.length > 0) {
                document.getElementById('activitiesList').innerHTML = activities.map(a => `
                    <div class="p-4 bg-slate-50 border-l-4 border-safety-green">
                        <p class="text-xs font-bold text-safety-green uppercase mb-1">${a.contractor || 'General'}</p>
                        <p class="text-sm text-slate-700">${a.narrative}</p>
                    </div>
                `).join('');
            }

            const operations = report.operations || [];
            if (operations.length > 0) {
                let totalWorkers = 0;
                const rows = operations.map(op => {
                    const total = (op.supers || 0) + (op.foreman || 0) + (op.operators || 0) + (op.laborers || 0) + (op.others || 0);
                    totalWorkers += total;
                    return `<tr class="border-b border-slate-200"><td class="py-2 px-3 font-bold text-slate-800">${op.contractor}</td><td class="py-2 px-3 text-center">${op.supers || 0}</td><td class="py-2 px-3 text-center">${op.foreman || 0}</td><td class="py-2 px-3 text-center">${op.operators || 0}</td><td class="py-2 px-3 text-center">${op.laborers || 0}</td><td class="py-2 px-3 text-center font-bold text-dot-blue">${total}</td></tr>`;
                }).join('');
                document.getElementById('personnelTable').innerHTML = `<table class="w-full text-sm"><thead><tr class="bg-dot-navy text-white"><th class="py-2 px-3 text-left font-bold uppercase text-xs">Contractor</th><th class="py-2 px-3 text-center font-bold uppercase text-xs">Supers</th><th class="py-2 px-3 text-center font-bold uppercase text-xs">Foreman</th><th class="py-2 px-3 text-center font-bold uppercase text-xs">Operators</th><th class="py-2 px-3 text-center font-bold uppercase text-xs">Laborers</th><th class="py-2 px-3 text-center font-bold uppercase text-xs">Total</th></tr></thead><tbody>${rows}</tbody><tfoot><tr class="bg-safety-green/10 border-t-2 border-safety-green"><td class="py-2 px-3 font-bold text-safety-green uppercase" colspan="5">Total Personnel</td><td class="py-2 px-3 text-center font-bold text-safety-green text-lg">${totalWorkers}</td></tr></tfoot></table>`;
            }

            const equipment = report.equipment || [];
            if (equipment.length > 0) {
                document.getElementById('equipmentList').innerHTML = equipment.map(e => `<div class="flex items-center justify-between p-3 bg-dot-yellow/10 border border-dot-yellow"><span class="font-bold text-slate-800">${e.model}</span><span class="text-sm text-slate-600">${e.contractor} • Qty: ${e.quantity}</span></div>`).join('');
            }

            const issues = report.generalIssues || [];
            const naMarked = report.meta?.naMarked || {};
            if (naMarked.issues) {
                document.getElementById('issuesList').innerHTML = `<div class="p-4 bg-safety-green/10 border-2 border-safety-green text-center"><i class="fas fa-check-circle text-safety-green mr-2"></i><span class="font-bold text-safety-green uppercase">No Issues Reported</span></div>`;
            } else if (issues.length > 0) {
                document.getElementById('issuesList').innerHTML = issues.map(issue => `<div class="flex items-start gap-3 p-4 bg-red-50 border-l-4 border-red-500"><i class="fas fa-exclamation-circle text-red-500 mt-0.5"></i><p class="text-sm text-slate-700">${issue}</p></div>`).join('');
            }

            const inspections = report.qaqcNotes || [];
            if (naMarked.inspections) {
                document.getElementById('inspectionsList').innerHTML = `<div class="p-4 bg-slate-100 border border-slate-300 text-center"><span class="text-slate-500 uppercase">N/A - No Inspections Today</span></div>`;
            } else if (inspections.length > 0) {
                document.getElementById('inspectionsList').innerHTML = inspections.map(note => `<div class="flex items-start gap-3 p-4 bg-violet-50 border-l-4 border-violet-500"><i class="fas fa-check-circle text-violet-500 mt-0.5"></i><p class="text-sm text-slate-700">${note}</p></div>`).join('');
            }

            const safety = report.safety || {};
            if (safety.hasIncidents) {
                document.getElementById('safetyStatus').innerHTML = `<div class="p-4 bg-red-600 text-white text-center"><i class="fas fa-exclamation-triangle mr-2"></i><span class="font-bold uppercase">Safety Incident Reported</span></div>`;
            } else {
                document.getElementById('safetyStatus').innerHTML = `<div class="p-4 bg-safety-green text-white text-center"><i class="fas fa-shield-alt mr-2"></i><span class="font-bold uppercase">No Safety Incidents</span></div>`;
            }
            if (safety.notes && safety.notes.length > 0) {
                document.getElementById('safetyNotes').innerHTML = safety.notes.map(note => `<div class="flex items-start gap-3 p-4 bg-green-50 border-l-4 border-safety-green"><i class="fas fa-shield-alt text-safety-green mt-0.5"></i><p class="text-sm text-slate-700">${note}</p></div>`).join('');
            }

            const visitors = report.visitorsRemarks || [];
            if (naMarked.visitors) {
                document.getElementById('visitorsList').innerHTML = `<div class="p-4 bg-slate-100 border border-slate-300 text-center"><span class="text-slate-500 uppercase">N/A - No Visitors Today</span></div>`;
            } else if (visitors.length > 0) {
                document.getElementById('visitorsList').innerHTML = visitors.map(v => `<div class="flex items-start gap-3 p-4 bg-slate-50 border-l-4 border-dot-blue"><i class="fas fa-user text-dot-blue mt-0.5"></i><p class="text-sm text-slate-700">${v}</p></div>`).join('');
            }

            const photos = report.photos || [];
            if (photos.length > 0) {
                document.getElementById('photosPage').classList.remove('hidden');
                document.getElementById('photosGrid').innerHTML = photos.map(p => `<div class="border border-slate-200 overflow-hidden"><img src="${p.url}" class="w-full h-48 object-cover"><div class="p-3 bg-slate-50"><p class="text-xs text-slate-500">${p.time || ''} • ${p.date || ''}</p>${p.gps ? `<p class="text-[10px] text-slate-400 mt-1"><i class="fas fa-map-marker-alt mr-1"></i>${p.gps.lat?.toFixed(5)}, ${p.gps.lng?.toFixed(5)}</p>` : ''}</div></div>`).join('');
            }

            document.getElementById('preparedBy').textContent = o.completedBy || 'Inspector Name, RPR';
            document.getElementById('signatureDate').textContent = o.date || new Date().toLocaleDateString();
        }

        function exportReport() {
            const report = getReport();
            if (!report) return;
            const dataStr = JSON.stringify(report, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `RPR_Report_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        document.addEventListener('DOMContentLoaded', renderReport);
    </script>
</body>
</html>
